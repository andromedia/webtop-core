Strophe.addConnectionPlugin("disco",{_connection:null,_identities:[],_features:[],_items:[],init:function(t){this._connection=t,this._identities=[],this._features=[],this._items=[],t.addHandler(this._onDiscoInfo.bind(this),Strophe.NS.DISCO_INFO,"iq","get",null,null),t.addHandler(this._onDiscoItems.bind(this),Strophe.NS.DISCO_ITEMS,"iq","get",null,null)},addIdentity:function(t,e,i,n){for(var s=0;s<this._identities.length;s++)if(this._identities[s].category==t&&this._identities[s].type==e&&this._identities[s].name==i&&this._identities[s].lang==n)return!1;return this._identities.push({category:t,type:e,name:i,lang:n}),!0},addFeature:function(t){for(var e=0;e<this._features.length;e++)if(this._features[e]==t)return!1;return this._features.push(t),!0},removeFeature:function(t){for(var e=0;e<this._features.length;e++)if(this._features[e]===t)return this._features.splice(e,1),!0;return!1},addItem:function(t,e,i,n){return!(i&&!n)&&(this._items.push({jid:t,name:e,node:i,call_back:n}),!0)},info:function(t,e,i,n,s){var r={xmlns:Strophe.NS.DISCO_INFO};e&&(r.node=e);var o=$iq({from:this._connection.jid,to:t,type:"get"}).c("query",r);return this._connection.sendIQ(o,i,n,s)},items:function(t,e,i,n,s){var r={xmlns:Strophe.NS.DISCO_ITEMS};e&&(r.node=e);var o=$iq({from:this._connection.jid,to:t,type:"get"}).c("query",r);this._connection.sendIQ(o,i,n,s)},_buildIQResult:function(t,e){var i=t.getAttribute("id"),n=t.getAttribute("from"),s=$iq({type:"result",id:i});return null!==n&&s.attrs({to:n}),s.c("query",e)},_onDiscoInfo:function(t){var e=t.getElementsByTagName("query")[0].getAttribute("node"),i={xmlns:Strophe.NS.DISCO_INFO};e&&(i.node=e);for(var n=this._buildIQResult(t,i),s=0;s<this._identities.length;s++){i={category:this._identities[s].category,type:this._identities[s].type};this._identities[s].name&&(i.name=this._identities[s].name),this._identities[s].lang&&(i["xml:lang"]=this._identities[s].lang),n.c("identity",i).up()}for(s=0;s<this._features.length;s++)n.c("feature",{var:this._features[s]}).up();return this._connection.send(n.tree()),!0},_onDiscoItems:function(t){var e={xmlns:Strophe.NS.DISCO_ITEMS},i=t.getElementsByTagName("query")[0].getAttribute("node");if(i){e.node=i;for(var n=[],s=0;s<this._items.length;s++)if(this._items[s].node==i){n=this._items[s].call_back(t);break}}else n=this._items;var r=this._buildIQResult(t,e);for(s=0;s<n.length;s++){var o={jid:n[s].jid};n[s].name&&(o.name=n[s].name),n[s].node&&(o.node=n[s].node),r.c("item",o).up()}return this._connection.send(r.tree()),!0}});